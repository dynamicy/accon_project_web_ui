<html>
<head>
<title></title>
<link type="text/css" href="styles/prettyPhoto.css" rel="stylesheet" id="prettyphoto-css" media="all">
<link type="text/css" href="styles/osgi.style.css" rel="stylesheet">
<script type='text/javascript' src='scripts/jquery-1.8.3.min.js'></script>
<script type='text/javascript' src='scripts/jquery.prettyPhoto.js'></script>
<script type='text/javascript' src='scripts/jquery.fancygallery.min.js'></script>
<script language="JavaScript">
//<!--
	function FP_preloadImgs() {//v1.0
	 var d=document,a=arguments; if(!d.FP_imgs) d.FP_imgs=new Array();
	 for(var i=0; i<a.length; i++) { d.FP_imgs[i]=new Image; d.FP_imgs[i].src=a[i]; }
	}
	
	function FP_swapImg() {//v1.0
	 var doc=document,args=arguments,elm,n; doc.$imgSwaps=new Array(); for(n=2; n<args.length;
	 n+=2) { elm=FP_getObjectByID(args[n]); if(elm) { doc.$imgSwaps[doc.$imgSwaps.length]=elm;
	 elm.$src=elm.src; elm.src=args[n+1]; } }
	}
	
	function FP_getObjectByID(id,o) {//v1.0
	 var c,el,els,f,m,n; if(!o)o=document; if(o.getElementById) el=o.getElementById(id);
	 else if(o.layers) c=o.layers; else if(o.all) el=o.all[id]; if(el) return el;
	 if(o.id==id || o.name==id) return o; if(o.childNodes) c=o.childNodes; if(c)
	 for(n=0; n<c.length; n++) { el=FP_getObjectByID(id,c[n]); if(el) return el; }
	 f=o.forms; if(f) for(n=0; n<f.length; n++) { els=f[n].elements;
	 for(m=0; m<els.length; m++){ el=FP_getObjectByID(id,els[n]); if(el) return el; } }
	 return null;
	}
// -->
	function smart_home_req(val,obj_name){
		var msg = new Array();
		msg[0]="MMN_SmartSocketBundle.Service_SmartSocket_Interface Set_Relay1_ON";
		msg[1]="MMN_SmartSocketBundle.Service_SmartSocket_Interface Set_Relay1_OFF";
		msg[2]="MMN_SmartSocketBundle.Service_SmartSocket_Interface Set_Relay2_ON";
		msg[3]="MMN_SmartSocketBundle.Service_SmartSocket_Interface Set_Relay2_OFF";
		$.get("socket_client.php?msg="+msg[val], function(data){check_error(data,val,obj_name)});
	}
	
	function check_error(data,val,obj_name){
		//var obj_id='div_test';
		if(data=="Fail\n"){
			setTimeout(function(){smart_home_req(val,obj)},1000);
		}
		else{
			var obj = document.getElementById(obj_name);
			obj.innerHTML = data;//Return Message
		}
	}
</script>
    <script type="text/javascript">
        $(document).ready(function () 
        {
            var DataExtractor = function () 
            {
                var me = this;
                me.getBundle = function (handler) 
                {
                    $.get('../xml_sample/alldata.xml', function (data) 
                    {
                        if (handler && data) 
                        {
                            var devices = {};
                            var root = $(data).find('Root');
							                                                    
                            root.children().each(function()
                            {
                                var device = $(this);
                                var did = device.attr('type').toLowerCase();
                                var modules = {};
                                                               
                                device.children().each(function () 
                                {
                                	var module = {};
                                	$(this).children().each(function(){
                                		module[$(this).prop('tagName').toLowerCase()] = $(this).text();
	                                	//module[$(this).prop('address').toLowerCase()] = $(this).text();
                                	});
                                	
                                	modules[module.type + '_' + module.room] = module;
                                    //jBun[$(this).prop('tagName').toLowerCase()] = $(this).text();
                                });
                           
                                devices[did] = modules;
                                
                            });
                            handler(devices);
                        }
                    });
                };
            };

            var extractor = new DataExtractor();           
            setInterval(modifyUIData, 3000, extractor);

            function modifyUIData(extractor) 
            {
          		// Initial
            	if(!extractor)
            	{
                    var appBtn1 = $('#appButton1');
	                var appBtn2 = $('#appButton2');
                    var appBtn3 = $('#appButton3');
	                var appBtn4 = $('#appButton4');
                    var appBtn5 = $('#appButton5');
	                var appBtn6 = $('#appButton6');
                    var appBtn7 = $('#appButton7');
	                var appBtn8 = $('#appButton8');
	                	        
					appBtn1.hide();
					appBtn2.hide();
					appBtn3.hide();
					appBtn4.hide();
					appBtn5.hide();
					appBtn6.hide();
					appBtn7.hide();
					appBtn8.hide();																					                	                                       
	            	return;           	
            	}

            	// Normal case
                extractor.getBundle(function (devices) 
                {
                    var zstackDevice = devices['zstack'];
                    var aspireDevice = devices['aspire'];
                    var smartphoneDevice = devices['smartphone'];
                    var smartsocketDevice = devices['smartsocket'];     
                    
					var m140a = zstackDevice['140_A'];
					var m140b = zstackDevice['140_B'];
										
                    $('#140aAddress').text(m140a.address);       
                    $('#140aType').text(m140a.type);  
                    $('#140aData').text(m140a.data);                      
                    
                    $('#140bAddress').text(m140b.address);       
                    $('#140bType').text(m140b.type);  
                    $('#140bData').text(m140b.data);                      

                    map.updata();
                });
            }

            var IMap = function () {
                var me = this;

                me.updata = function () {                  
                    var pins = $(".pin");
                    me.clearDirty();
                    pins.each(function () {
                        var pin = $(this);
                        var tooltipDirection = pin.hasClass('pin-down') ? 'tooltip-down' : 'tooltip-up';
                        var tooltip = $('<div class="tooltip">' + pin.html() + '</div>');
                        var dirty = $("<div style='left:" + pin.data('xpos') + "px;top:" + pin.data('ypos') + "px' class='" + tooltipDirection + "'></div>");
                        dirty.append(tooltip);
                        me.wrapper.append(dirty);
                    });

                    $('.tooltip-up, .tooltip-down').mouseenter(function () {
                        $(this).children('.tooltip').fadeIn(100);
                    }).mouseleave(function () {
                        $(this).children('.tooltip').fadeOut(100);
                    })
                };
                
                me.clearDirty = function () {
                    me.wrapper.find('.tooltip-down').remove();
                    me.wrapper.find('.tooltip-up').remove();                    
                }

                me.wrappedImg = $('#wrapper img');
                if (me.wrappedImg) {
                    me.wrapper = $('#wrapper').css({
                        'width': me.wrappedImg.width(),
                        'height': me.wrappedImg.height()
                    });                    
                    me.updata();
                }
            };
			modifyUIData();
            var map = new IMap();
        });
    </script>
    <script type="text/javascript">
    	$(document).ready(function (){
	    	var count = 0;
	    	$('#btnTest').click(function (){
	    		count++;
				if(count>=0)
				{
					$('#bgsrc').attr('src', 'images/bg'+count+'.png');
				}	
				else if(count>3)
				{
					count = 0;
				}
			}); 	
    	});
    </script>
</head>

<body>
<div id="wrapper">
    <img width="700" height="446" src="images/bg1.png" id="bgsrc" alt="House"> 
    <div class="pin pin-down" data-xpos="31" data-ypos="205">
        <label><b>Address: </b></label><span id="140aAddress"></span><br>
        <label><b>Type: </b></label><span id="140aType"></span><br>
        <label><b>Data:</b></label><span id="140aData"></span><br>
    </div>
    <div class="pin pin-down" data-xpos="50" data-ypos="325">
        <label><b>Address:</b> </label><span id="140bAddress"></span><br>
        <label><b>Type:</b> </label><span id="140bType"></span><br>
        <label><b>Data:</b> </label><span id="140bData"></span><br>
    </div>                  
</div>
<button id="btnTest">Click me</button>
<div align="center" id="div_test"></div>       
</body>
</html>